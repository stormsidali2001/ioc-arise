---
title: Factory Functions
description: Use factory functions for dependency injection with custom logic, context objects, and currying patterns
sidebar:
  order: 5
---

import { FileTree, Card, CardGrid, Badge, Tabs, TabItem } from '@astrojs/starlight/components';

<div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0 2rem 0;">
  <Badge text="Factory Pattern" variant="tip" />
  <Badge text="Functional Programming" variant="success" />
  <Badge text="Context Objects" variant="note" />
</div>

Factory functions allow you to create instances with custom business logic, validation, or conditional setup that goes beyond simple constructor injection.

## Project Structure

<FileTree>
- factory-functions-example/
  - repositories/
    - IUserRepository.ts
    - UserRepository.ts
    - ITodoRepository.ts
    - TodoRepository.ts
  - factories/
    - todoUseCaseFactory.ts    # Context object pattern
    - userUseCaseFactory.ts     # Separate parameters pattern
  - container.gen.ts
  - demo.ts
</FileTree>

## Patterns

<CardGrid>
  <Card title="üì¶ Context Object" icon="seti:typescript">
    Dependencies as a single object parameter
  </Card>
  
  <Card title="üîß Separate Parameters" icon="rocket">
    Traditional parameter-based injection
  </Card>
</CardGrid>

## Examples

<Tabs>
  <TabItem label="Context Object Pattern">

```typescript
// factories/todoUseCaseFactory.ts
export function createTodoUseCase(
    context: { userRepo: IUserRepository, todoRepo: ITodoRepository }
) {
    return (userId: string, title: string): void => {
        const user = context.userRepo.getUser(userId);
        context.todoRepo.saveTodo(title);
    };
}
```

**Generated:**

```typescript
container.register('createTodoUseCase', {
  useFactory: (userRepo, todoRepo) => createTodoUseCase({ userRepo, todoRepo }),
  dependencies: ['IUserRepository', 'ITodoRepository'],
  lifecycle: Lifecycle.Singleton,
});
```

  </TabItem>
  <TabItem label="Separate Parameters">

```typescript
// factories/userUseCaseFactory.ts
export function createUserUseCase(
    userRepo: IUserRepository
) {
    return (userId: string): string => {
        return userRepo.getUser(userId);
    };
}
```

**Generated:**

```typescript
container.register('createUserUseCase', {
  useFactory: createUserUseCase,
  dependencies: ['IUserRepository'],
  lifecycle: Lifecycle.Singleton,
});
```

  </TabItem>
</Tabs>

## Detection

Functions are automatically detected if they:
- Are marked with `@factory` JSDoc annotation (default behavior)
- Match the `factoryPattern` regex if configured in `ioc.config.json`
- Are exported

```typescript
// ‚úÖ Detected - marked with @factory
/**
 * @factory
 */
export function myFactory() {
  return { /* ... */ };
}

// ‚úÖ Detected - matches factoryPattern if configured (e.g., "factory")
export function createUserFactory(repo: IUserRepository) {
  return { /* ... */ };
}

// ‚ùå Not detected - no @factory annotation and doesn't match pattern
export function getUserService() {
  return { /* ... */ };
}

// ‚ùå Not detected - not exported
function createService() {
  return { /* ... */ };
}
```

## Lifecycle

<Tabs>
  <TabItem label="Singleton (Default)">

```typescript
/**
 * @scope singleton
 */
export function createService() {
  return { /* ... */ };
}
```

  </TabItem>
  <TabItem label="Transient">

```typescript
/**
 * @scope transient
 */
export function createService() {
  return { /* ... */ };
}
```

  </TabItem>
</Tabs>

## Usage

```typescript
import { container } from './container.gen';

const createTodo = container.resolve('createTodoUseCase');
createTodo('user-1', 'Buy groceries');
```

## When to Use

<CardGrid>
  <Card title="‚úÖ Use Factories" icon="check">
    ‚Ä¢ Custom creation logic  
    ‚Ä¢ Validation or conditional setup  
    ‚Ä¢ Returning functions (currying)  
    ‚Ä¢ Functional programming style
  </Card>
  
  <Card title="‚ùå Use Classes" icon="x">
    ‚Ä¢ Simple constructor injection  
    ‚Ä¢ Standard OOP patterns  
    ‚Ä¢ No custom logic needed
  </Card>
</CardGrid>
